{
	"info": {
		"_postman_id": "b7147e7a-d91e-4905-8e59-7d16ea5bb55d",
		"name": "Prepare_for_DEV_INT",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_uid": "3558839-b7147e7a-d91e-4905-8e59-7d16ea5bb55d"
	},
	"item": [
		{
			"name": "Get and Validate all Policy Actions",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {\r",
							"    pm.response.to.have.status(200);\r",
							"});\r",
							"\r",
							"let policyActions = JSON.parse(responseBody).policyAction;\r",
							"if (policyActions === undefined || policyActions === null || policyActions.length === 0) {\r",
							"} else {\r",
							"    for (i in policyActions) {\r",
							"        if ((policyActions[i].templateKey === \"logInvocation\") && (policyActions[i].id !== \"GlobalLogInvocationPolicyAction\")) {\r",
							"            console.log(\"Log Invocation policy not allowed on API level\");\r",
							"            console.log(\"ID: \" + policyActions[i].id);\r",
							"            console.log(\"Name: \" + policyActions[i].names[0].value);\r",
							"\r",
							"            pm.test(\"No local Log Invocation policies\", function () {\r",
							"                pm.expect(policyActions[i].templateKey).not.to.be.equal(\"logInvocation\");\r",
							"            });\r",
							"\r",
							"            postman.setNextRequest(null);\r",
							"            break;\r",
							"        }\r",
							"    }\r",
							"}"
						],
						"type": "text/javascript",
						"id": "b8ec5c39-6ada-403d-8232-ed19390dadd0"
					}
				}
			],
			"id": "c2c783f5-ebe6-440e-aa8e-00677e7847bb",
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Accept",
						"value": "application/json",
						"type": "text"
					},
					{
						"key": "Host",
						"value": "{{hostname}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "https://{{ip}}:{{port}}/rest/apigateway/policyActions",
					"protocol": "https",
					"host": [
						"{{ip}}"
					],
					"port": "{{port}}",
					"path": [
						"rest",
						"apigateway",
						"policyActions"
					]
				}
			},
			"response": []
		},
		{
			"name": "Get and Validate all Applications",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {\r",
							"    pm.response.to.have.status(200);\r",
							"});\r",
							"\r",
							"let apiResponse=JSON.parse(responseBody);\r",
							"let applications = apiResponse.applications;\r",
							"if (applications === undefined || applications === null || applications.length === 0) {\r",
							"} else {\r",
							"    for (i in applications) {\r",
							"        if (!(applications[i].name.endsWith(\"_CONFIG\") || applications[i].name.endsWith(\"_DEV\")\r",
							"                || applications[i].name.endsWith(\"_STAGE\") || applications[i].name.endsWith(\"_TEST\")\r",
							"                || applications[i].name.endsWith(\"_PROD\"))) {\r",
							"            console.log(\"Application name must end with _ plus environment name\");\r",
							"            console.log(\"ID: \" + applications[i].id);\r",
							"            console.log(\"Name: \" + applications[i].name);\r",
							"            console.log(\"Version: \" + applications[i].version);\r",
							"            console.log(\"Description: \" + applications[i].description);\r",
							"\r",
							"            pm.test(\"Application name end with _ plus environment name\", function () {\r",
							"                pm.expect.fail(\"Application name does not end with _ plus environment name: \" + applications[i].name);\r",
							"            });\r",
							"\r",
							"            postman.setNextRequest(null);\r",
							"            break;\r",
							"        }\r",
							"    }\r",
							"}"
						],
						"type": "text/javascript",
						"id": "4ab3dc0e-eeda-4d93-9bcc-980d3386b257"
					}
				}
			],
			"id": "4465dbe3-2ba7-49fc-bddd-c8bcbca91d72",
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Accept",
						"type": "text",
						"value": "application/json"
					},
					{
						"key": "Host",
						"value": "{{hostname}}"
					}
				],
				"url": {
					"raw": "https://{{ip}}:{{port}}/rest/apigateway/applications",
					"protocol": "https",
					"host": [
						"{{ip}}"
					],
					"port": "{{port}}",
					"path": [
						"rest",
						"apigateway",
						"applications"
					]
				}
			},
			"response": []
		},
		{
			"name": "Get all Aliases",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {\r",
							"    pm.response.to.have.status(200);\r",
							"});\r",
							"\r",
							"let aliasesString = pm.variables.get(\"aliases\");\r",
							"let globalAliasesString = pm.variables.get(\"globalAliases\");\r",
							"\r",
							"// console.log(\"aliases Postman variable: \" + aliasesString);\r",
							"// console.log(\"globalAliases Postman variable: \" + globalAliasesString);\r",
							"\r",
							"let oldAliases = JSON.parse(responseBody).alias;\r",
							"\r",
							"let aliasIds = [];\r",
							"let remainingAliases = [];\r",
							"postman.setNextRequest(\"Get all Applications\");\r",
							"\r",
							"if (aliasesString !== undefined && aliasesString !== null && aliasesString !== \"\") {\r",
							"    let aliases = JSON.parse(aliasesString);\r",
							"\r",
							"//    console.log(\"Parsed aliases Postman variable: \" + JSON.stringify(aliases));\r",
							"\r",
							"    if (aliases.length > 0) {\r",
							"        for (var i=0; i<aliases.length; i++) { // Check aliases\r",
							"            if (aliases[i] != undefined && aliases[i] != null\r",
							"                && aliases[i].id != undefined && aliases[i].id != null\r",
							"                && aliases[i].content != undefined && aliases[i].content != null\r",
							"                && aliases[i].content.name != undefined && aliases[i].content.name != null) {\r",
							"\r",
							"                let aliasId = aliases[i].id;\r",
							"\r",
							"//                console.log(\"Alias ID to be checked: \" + aliasId);\r",
							"\r",
							"                if (aliasIds.includes(aliasId)) {\r",
							"                    console.log(\"Duplicate alias definition!\");\r",
							"                    console.log(\"ID: \" + aliases[i].id);\r",
							"                    console.log(\"Name: \" + aliases[i].content.name);\r",
							"                    console.log(\"Description: \" + aliases[i].content.description);\r",
							"\r",
							"                    pm.test(\"Alias definition must be unique\", function () {\r",
							"                        pm.expect(aliasIds).not.to.include(aliasId);\r",
							"                    });\r",
							"\r",
							"                    remainingAliases = null;\r",
							"                    postman.setNextRequest(null);\r",
							"                    break;\r",
							"                }\r",
							"\r",
							"                let matchingaliases = oldAliases.filter(alias => alias.id === aliasId);\r",
							"\r",
							"//                console.log(\"Matching aliases: \" + JSON.stringify(matchingaliases));\r",
							"\r",
							"                if (matchingaliases.length === 0) { // No alias found\r",
							"                    console.log(\"No matching alias found!\");\r",
							"                    console.log(\"ID: \" + aliases[i].id);\r",
							"                    console.log(\"Name: \" + aliases[i].content.name);\r",
							"                    console.log(\"Description: \" + aliases[i].content.description);\r",
							"\r",
							"                    pm.test(\"Alias to be updated must exist\", function () {\r",
							"                        pm.expect(matchingaliases.length).to.be.equal(1);\r",
							"                    });\r",
							"\r",
							"                    remainingAliases = null;\r",
							"                    postman.setNextRequest(null);\r",
							"                    break;\r",
							"                } else if (matchingaliases.length === 1) { // One alias found\r",
							"//                    console.log(\"Found!\");\r",
							"\r",
							"                    if (matchingaliases[0].name !== aliases[i].content.name) {\r",
							"                        console.log(\"Names do not match!\");\r",
							"                        console.log(\"ID: \" + aliases[i].id);\r",
							"                        console.log(\"Name: \" + aliases[i].content.name);\r",
							"                        console.log(\"Description: \" + aliases[i].content.description);\r",
							"\r",
							"                        pm.test(\"Alias to be updated must have the same name\", function () {\r",
							"                            pm.expect(matchingaliases[0].name).to.be.equal(aliases[i].content.name);\r",
							"                        });\r",
							"\r",
							"                        remainingAliases = null;\r",
							"                        postman.setNextRequest(null);\r",
							"                        break;\r",
							"                    } else {\r",
							"                        remainingAliases.push(aliases[i]);\r",
							"                        aliasIds.push(aliases[i].id);\r",
							"                        postman.setNextRequest(\"Update one Alias\");\r",
							"                    }\r",
							"                } else { // More than one alias found\r",
							"                    console.log(\"More than one matching alias found!\");\r",
							"                    console.log(\"ID: \" + aliases[i].id);\r",
							"                    console.log(\"Name: \" + aliases[i].content.name);\r",
							"                    console.log(\"Description: \" + aliases[i].content.description);\r",
							"\r",
							"                    pm.test(\"Alias to be updated must exist\", function () {\r",
							"                        pm.expect(matchingaliases.length).to.be.equal(1);\r",
							"                    });\r",
							"\r",
							"                    remainingAliases = null;\r",
							"                    postman.setNextRequest(null);\r",
							"                    break;\r",
							"                }\r",
							"            } else {\r",
							"\t\t\t\tif (aliases[i] === undefined || aliases[i] === null) {\r",
							"\t\t\t\t\tconsole.log(\"Missing alias definition!\");\r",
							"\t\t\t\t} else if (aliases[i].id === undefined || aliases[i].id === null) {\r",
							"\t\t\t\t\tconsole.log(\"Missing alias ID!\");\r",
							"\t\t\t\t\tconsole.log(\"Alias: \" + JSON.stringify(aliases[i]));\r",
							"\t\t\t\t} else if (aliases[i].content === undefined || aliases[i].content === null) { // no value defined for this alias on this stage, not an error case!\r",
							"\t\t\t\t\tcontinue; // Just skip this alias\r",
							"\t\t\t\t} else if (aliases[i].content.name === undefined || aliases[i].content.name === null) {\r",
							"\t\t\t\t\tconsole.log(\"Missing alias name!\");\r",
							"\t\t\t\t\tconsole.log(\"ID: \" + aliases[i].id);\r",
							"\t\t\t\t\tconsole.log(\"Alias: \" + JSON.stringify(aliases[i]));\r",
							"\t\t\t\t}\r",
							"\r",
							"                pm.test(\"Consistent alias definition with id and name\", function () {\r",
							"                    pm.expect.fail(\"Inconsistent alias definition: Missing alias or missing id or missing content.name\");\r",
							"                });\r",
							"\r",
							"                remainingAliases = null;\r",
							"                postman.setNextRequest(null);\r",
							"                break;\r",
							"            }\r",
							"        }\r",
							"    }\r",
							"}\r",
							"\r",
							"if (remainingAliases !== null && globalAliasesString !== undefined && globalAliasesString !== null && globalAliasesString !== \"\") {\r",
							"    let globalAliases = JSON.parse(globalAliasesString);\r",
							"\r",
							"//    console.log(\"Parsed globalAliases Postman variable: \" + JSON.stringify(globalAliases));\r",
							"\r",
							"    if (globalAliases.length > 0) {\r",
							"        for (var i=0; i<globalAliases.length; i++) { // Check aliases\r",
							"            if (globalAliases[i] != undefined && globalAliases[i] != null\r",
							"                && globalAliases[i].id != undefined && globalAliases[i].id != null\r",
							"                && globalAliases[i].content != undefined && globalAliases[i].content != null\r",
							"                && globalAliases[i].content.name != undefined && globalAliases[i].content.name != null) {\r",
							"\r",
							"                let aliasId = globalAliases[i].id;\r",
							"\r",
							"//                console.log(\"Alias ID to be checked: \" + aliasId);\r",
							"\r",
							"                if (aliasIds.includes(aliasId)) {\r",
							"                    console.log(\"Duplicate alias definition!\");\r",
							"                    console.log(\"ID: \" + globalAliases[i].id);\r",
							"                    console.log(\"Name: \" + globalAliases[i].content.name);\r",
							"                    console.log(\"Description: \" + globalAliases[i].content.description);\r",
							"\r",
							"                    pm.test(\"Alias definition must be unique\", function () {\r",
							"                        pm.expect(aliasIds).not.to.include(aliasId);\r",
							"                    });\r",
							"\r",
							"                    remainingAliases = null;\r",
							"                    postman.setNextRequest(null);\r",
							"                    break;\r",
							"                }\r",
							"\r",
							"                let matchingaliases = oldAliases.filter(alias => alias.id === aliasId);\r",
							"\r",
							"//                console.log(\"Matching aliases: \" + JSON.stringify(matchingaliases));\r",
							"\r",
							"                if (matchingaliases.length === 0) { // No alias found, no error for global aliases\r",
							"//                    console.log(\"Not found!\");\r",
							"                } else if (matchingaliases.length === 1) { // One alias found\r",
							"//                    console.log(\"Found!\");\r",
							"\r",
							"                    if (matchingaliases[0].name !== globalAliases[i].content.name) {\r",
							"                        console.log(\"Names do not match!\");\r",
							"                        console.log(\"ID: \" + globalAliases[i].id);\r",
							"                        console.log(\"Name: \" + globalAliases[i].content.name);\r",
							"                        console.log(\"Description: \" + globalAliases[i].content.description);\r",
							"\r",
							"                        pm.test(\"Alias to be updated must have the same name\", function () {\r",
							"                            pm.expect(matchingaliases[0].name).to.be.equal(globalAliases[i].content.name);\r",
							"                        });\r",
							"\r",
							"                        remainingAliases = null;\r",
							"                        postman.setNextRequest(null);\r",
							"                        break;\r",
							"                    } else {\r",
							"                        remainingAliases.push(globalAliases[i]);\r",
							"                        aliasIds.push(globalAliases[i].id);\r",
							"                        postman.setNextRequest(\"Update one Alias\");\r",
							"                    }\r",
							"                } else { // More than one alias found\r",
							"                    console.log(\"More than one matching alias found!\");\r",
							"                    console.log(\"ID: \" + globalAliases[i].id);\r",
							"                    console.log(\"Name: \" + globalAliases[i].content.name);\r",
							"                    console.log(\"Description: \" + globalAliases[i].content.description);\r",
							"\r",
							"                    pm.test(\"Alias to be updated must exist\", function () {\r",
							"                        pm.expect(matchingaliases.length).to.be.equal(1);\r",
							"                    });\r",
							"\r",
							"                    remainingAliases = null;\r",
							"                    postman.setNextRequest(null);\r",
							"                    break;\r",
							"                }\r",
							"            } else {\r",
							"\t\t\t\tif (globalAliases[i] === undefined || globalAliases[i] === null) {\r",
							"\t\t\t\t\tconsole.log(\"Missing alias definition!\");\r",
							"\t\t\t\t} else if (globalAliases[i].id === undefined || globalAliases[i].id === null) {\r",
							"\t\t\t\t\tconsole.log(\"Missing alias ID!\");\r",
							"\t\t\t\t\tconsole.log(\"Alias: \" + JSON.stringify(globalAliases[i]));\r",
							"\t\t\t\t} else if (globalAliases[i].content === undefined || globalAliases[i].content === null) { // no value defined for this alias on this stage, not an error case!\r",
							"\t\t\t\t\tcontinue; // Just skip this alias\r",
							"\t\t\t\t} else if (globalAliases[i].content.name === undefined || globalAliases[i].content.name === null) {\r",
							"\t\t\t\t\tconsole.log(\"Missing alias name!\");\r",
							"\t\t\t\t\tconsole.log(\"ID: \" + globalAliases[i].id);\r",
							"\t\t\t\t\tconsole.log(\"Alias: \" + JSON.stringify(globalAliases[i]));\r",
							"\t\t\t\t}\r",
							"\r",
							"                pm.test(\"Consistent alias definition with id and name\", function () {\r",
							"                    pm.expect.fail(\"Inconsistent alias definition: Missing alias or missing id or missing content.name\");\r",
							"                });\r",
							"\r",
							"                remainingAliases = null;\r",
							"                postman.setNextRequest(null);\r",
							"                break;\r",
							"            }\r",
							"        }\r",
							"    }\r",
							"}\r",
							"\r",
							"if (remainingAliases !== null && remainingAliases.length > 0) {\r",
							"    let alias = remainingAliases.shift();\r",
							"    let aliasId = alias.id;\r",
							"    let aliasContent = alias.content;\r",
							"\r",
							"    remainingAliasesString = JSON.stringify(remainingAliases);\r",
							"    let aliasContentString = JSON.stringify(aliasContent);\r",
							"\r",
							"    console.log(\"Update alias\");\r",
							"    console.log(\"ID: \" + aliasId);\r",
							"    console.log(\"Name: \" + aliasContent.name);\r",
							"    console.log(\"Description: \" + aliasContent.description);\r",
							"\r",
							"    pm.globals.set(\"remainingAliases\", remainingAliasesString);\r",
							"    pm.globals.set(\"aliasContent\", aliasContentString);\r",
							"    pm.globals.set(\"aliasId\", aliasId);\r",
							"}"
						],
						"type": "text/javascript",
						"id": "93498f51-69a6-4f2f-8ad9-488bde9bdc2e"
					}
				}
			],
			"id": "ab62b42d-023a-4755-807c-a62efee0c92b",
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Accept",
						"type": "text",
						"value": "application/json"
					},
					{
						"key": "Host",
						"value": "{{hostname}}"
					}
				],
				"url": {
					"raw": "https://{{ip}}:{{port}}/rest/apigateway/alias",
					"protocol": "https",
					"host": [
						"{{ip}}"
					],
					"port": "{{port}}",
					"path": [
						"rest",
						"apigateway",
						"alias"
					]
				}
			},
			"response": []
		},
		{
			"name": "Update one Alias",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {\r",
							"    pm.response.to.have.status(200);\r",
							"});\r",
							"\r",
							"let aliasesString = pm.variables.get(\"remainingAliases\");\r",
							"\r",
							"// console.log(\"aliases Postman variable: \" + aliasesString);\r",
							"\r",
							"if (aliasesString === undefined || aliasesString === null || aliasesString === \"\") {\r",
							"    postman.setNextRequest(\"Get all Applications\");\r",
							"} else {\r",
							"    let aliases = JSON.parse(aliasesString);\r",
							"\r",
							"//    console.log(\"Parsed aliases Postman variable: \" + JSON.stringify(aliases));\r",
							"\r",
							"    if (aliases.length === 0) {\r",
							"        postman.setNextRequest(\"Get all Applications\");\r",
							"    } else {\r",
							"        let alias = aliases.shift();\r",
							"        let aliasId = alias.id;\r",
							"        let aliasContent = alias.content;\r",
							"\r",
							"        aliasesString = JSON.stringify(aliases);\r",
							"        let aliasContentString = JSON.stringify(aliasContent);\r",
							"\r",
							"        console.log(\"Update alias\");\r",
							"        console.log(\"ID: \" + aliasId);\r",
							"        console.log(\"Name: \" + aliasContent.name);\r",
							"        console.log(\"Description: \" + aliasContent.description);\r",
							"\r",
							"        pm.globals.set(\"remainingAliases\", aliasesString);\r",
							"        pm.globals.set(\"aliasContent\", aliasContentString);\r",
							"        pm.globals.set(\"aliasId\", aliasId);\r",
							"        \r",
							"        postman.setNextRequest(\"Update one Alias\");\r",
							"    }\r",
							"}"
						],
						"type": "text/javascript",
						"id": "e131b3ea-3455-4154-950b-2e1cb6958d57"
					}
				}
			],
			"id": "b8f8bb11-c38c-4dbd-acc4-86bf18f5ce3b",
			"request": {
				"method": "PUT",
				"header": [
					{
						"key": "Accept",
						"type": "text",
						"value": "application/json"
					},
					{
						"key": "Host",
						"value": "{{hostname}}"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{{aliasContent}}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "https://{{ip}}:{{port}}/rest/apigateway/alias/{{aliasId}}",
					"protocol": "https",
					"host": [
						"{{ip}}"
					],
					"port": "{{port}}",
					"path": [
						"rest",
						"apigateway",
						"alias",
						"{{aliasId}}"
					]
				}
			},
			"response": []
		},
		{
			"name": "Get all Applications",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {\r",
							"    pm.response.to.have.status(200);\r",
							"});\r",
							"\r",
							"postman.setNextRequest(null);\r",
							"\r",
							"let apiResponse=JSON.parse(responseBody);\r",
							"let applications = apiResponse.applications;\r",
							"if (applications === undefined || applications === null || applications.length === 0) {\r",
							"    postman.setNextRequest(\"Get all Strategies\");\r",
							"} else {\r",
							"    let applicationsToBeDeleted = applications.filter(function(application, index, arr){ \r",
							"        return !application.name.endsWith(\"_DEV\");\r",
							"    });\r",
							"    if (applicationsToBeDeleted.length === 0) {\r",
							"        let applicationsToBeUnsuspended = applications.filter(function(application, index, arr){ \r",
							"            return (application.isSuspended === true);\r",
							"        });\r",
							"        if (applicationsToBeUnsuspended.length === 0) {\r",
							"            postman.setNextRequest(\"Get all Strategies\");\r",
							"        } else {\r",
							"            pm.globals.set(\"applicationId\", applicationsToBeUnsuspended[0].id);\r",
							"\r",
							"            console.log(\"Unsuspend application\");\r",
							"            console.log(\"ID: \" + applicationsToBeUnsuspended[0].id);\r",
							"            console.log(\"Name: \" + applicationsToBeUnsuspended[0].name);\r",
							"            console.log(\"Version: \" + applicationsToBeUnsuspended[0].version);\r",
							"\r",
							"            postman.setNextRequest(\"Unsuspend one Application\");\r",
							"        }\r",
							"    } else {\r",
							"        pm.globals.set(\"applicationId\", applicationsToBeDeleted[0].id);\r",
							"\r",
							"        console.log(\"Delete application\");\r",
							"        console.log(\"ID: \" + applicationsToBeDeleted[0].id);\r",
							"        console.log(\"Name: \" + applicationsToBeDeleted[0].name);\r",
							"        console.log(\"Version: \" + applicationsToBeDeleted[0].version);\r",
							"\r",
							"        postman.setNextRequest(\"Delete one Application\");\r",
							"    }\r",
							"}"
						],
						"type": "text/javascript",
						"id": "e731d7d4-4253-403b-8a36-2f0948cf48fa"
					}
				}
			],
			"id": "7298c947-a0d0-4317-a416-033f1db895a1",
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Accept",
						"value": "application/json",
						"type": "text"
					},
					{
						"key": "Host",
						"value": "{{hostname}}"
					}
				],
				"url": {
					"raw": "https://{{ip}}:{{port}}/rest/apigateway/applications",
					"protocol": "https",
					"host": [
						"{{ip}}"
					],
					"port": "{{port}}",
					"path": [
						"rest",
						"apigateway",
						"applications"
					]
				}
			},
			"response": []
		},
		{
			"name": "Delete one Application",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 204\", function () {\r",
							"    pm.response.to.have.status(204);\r",
							"});\r",
							"\r",
							"postman.setNextRequest(null);\r",
							"\r",
							"if (pm.response.code === 204) {\r",
							"    postman.setNextRequest(\"Get all Applications\");\r",
							"}"
						],
						"type": "text/javascript",
						"id": "4f42de4e-ac22-4a1a-83e5-4679bcb2dbe5"
					}
				}
			],
			"id": "93e45555-88a6-4034-be0d-99844ca8bf97",
			"request": {
				"method": "DELETE",
				"header": [
					{
						"key": "Accept",
						"value": "application/json",
						"type": "text"
					},
					{
						"key": "Host",
						"value": "{{hostname}}"
					}
				],
				"url": {
					"raw": "https://{{ip}}:{{port}}/rest/apigateway/applications/{{applicationId}}",
					"protocol": "https",
					"host": [
						"{{ip}}"
					],
					"port": "{{port}}",
					"path": [
						"rest",
						"apigateway",
						"applications",
						"{{applicationId}}"
					]
				}
			},
			"response": []
		},
		{
			"name": "Unsuspend one Application",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {\r",
							"    pm.response.to.have.status(200);\r",
							"});\r",
							"\r",
							"postman.setNextRequest(null);\r",
							"\r",
							"if (pm.response.code === 200) {\r",
							"    postman.setNextRequest(\"Get all Applications\");\r",
							"}"
						],
						"type": "text/javascript",
						"id": "5e7c507f-1679-4511-b707-292f9f0b40a8"
					}
				}
			],
			"id": "ac7d9b10-231c-44cf-875f-a439f9ee032a",
			"request": {
				"method": "PATCH",
				"header": [
					{
						"key": "Accept",
						"value": "application/json",
						"type": "text"
					},
					{
						"key": "Host",
						"value": "{{hostname}}"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\"isSuspended\": false}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "https://{{ip}}:{{port}}/rest/apigateway/applications/{{applicationId}}",
					"protocol": "https",
					"host": [
						"{{ip}}"
					],
					"port": "{{port}}",
					"path": [
						"rest",
						"apigateway",
						"applications",
						"{{applicationId}}"
					]
				}
			},
			"response": []
		},
		{
			"name": "Get all Strategies",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {\r",
							"    pm.response.to.have.status(200);\r",
							"});\r",
							"\r",
							"postman.setNextRequest(null);\r",
							"\r",
							"let apiResponse=JSON.parse(responseBody);\r",
							"let strategies = apiResponse.strategies;\r",
							"if (strategies === undefined || strategies === null || strategies.length === 0) {\r",
							"    postman.setNextRequest(\"Get all APIs\"); //es ist nichts zu tun, keine strategies vorhanden\r",
							"} else {\r",
							"    //strategies[0] wird hier behandelt, alle weiteren müssen an den nächsten request weitergereicht werden.\r",
							"    let remainingStrategies = [];\r",
							"    for (var i=1; i<strategies.length; i++) { \r",
							"        remainingStrategies.push(strategies[i])\r",
							"    }    \r",
							"    pm.globals.set(\"remainingStrategies\", JSON.stringify(remainingStrategies))\r",
							"    \r",
							"    console.log(\"Sanitize strategy - remove dcrConfig.ClientId and dcrConfig.clientSecret\");\r",
							"    console.log(\"ID: \" + strategies[0].id);\r",
							"    console.log(\"Name: \" + strategies[0].name);\r",
							"    console.log(\"Decription: \" + strategies[0].description);        \r",
							"    delete strategies[0].dcrConfig.clientId;\r",
							"    delete strategies[0].dcrConfig.clientSecret;\r",
							"\r",
							"    pm.globals.set(\"strategyContent\", JSON.stringify(strategies[0]));\r",
							"    pm.globals.set(\"strategyId\", strategies[0].id)\r",
							"    \r",
							"    postman.setNextRequest(\"Update one Strategy\");\r",
							"\r",
							"}"
						],
						"type": "text/javascript",
						"id": "801e24b5-7ccf-4749-bcde-c9df91f4e8a8"
					}
				}
			],
			"id": "627c4971-129b-417c-ae8e-e73d7f62673f",
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Accept",
						"value": "application/json",
						"type": "text"
					},
					{
						"key": "Host",
						"value": "{{hostname}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "https://{{ip}}:{{port}}/rest/apigateway/strategies",
					"protocol": "https",
					"host": [
						"{{ip}}"
					],
					"port": "{{port}}",
					"path": [
						"rest",
						"apigateway",
						"strategies"
					]
				}
			},
			"response": []
		},
		{
			"name": "Update one Strategy",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {\r",
							"    pm.response.to.have.status(200);\r",
							"});\r",
							"\r",
							"let strategies = JSON.parse(pm.variables.get(\"remainingStrategies\"));\r",
							"\r",
							"if (strategies === undefined || strategies === null || strategies.length === 0) {\r",
							"    postman.setNextRequest(\"Get all APIs\"); //es ist nichts (mehr) zu tun, alle strategies wurden abgearbeitet\r",
							"} else {\r",
							"    //strategies[0] wird hier behandelt, alle weiteren müssen an den nächsten request weitergereicht werden.\r",
							"    let remainingStrategies = [];\r",
							"    for (var i=1; i<strategies.length; i++) { \r",
							"        remainingStrategies.push(strategies[i])\r",
							"    }    \r",
							"    pm.globals.set(\"remainingStrategies\", JSON.stringify(remainingStrategies))\r",
							"    \r",
							"    console.log(\"Sanitize strategy - remove dcrConfig.ClientId and dcrConfig.clientSecret\");\r",
							"    console.log(\"ID: \" + strategies[0].id);\r",
							"    console.log(\"Name: \" + strategies[0].name);\r",
							"    console.log(\"Decription: \" + strategies[0].description);        \r",
							"    delete strategies[0].dcrConfig.clientId;\r",
							"    delete strategies[0].dcrConfig.clientSecret;\r",
							"\r",
							"    pm.globals.set(\"strategyContent\", JSON.stringify(strategies[0]));\r",
							"    pm.globals.set(\"strategyId\", strategies[0].id)\r",
							"    \r",
							"    postman.setNextRequest(\"Update one Strategy\");\r",
							"\r",
							"}"
						],
						"type": "text/javascript",
						"id": "7392ee80-28a1-4a69-9bd4-2e0d4bb0af31"
					}
				}
			],
			"id": "49945390-ea9a-4927-92cd-f28ca13a4b46",
			"request": {
				"method": "PUT",
				"header": [
					{
						"key": "Accept",
						"type": "text",
						"value": "application/json"
					},
					{
						"key": "Host",
						"value": "{{hostname}}",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{{strategyContent}}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "https://{{ip}}:{{port}}/rest/apigateway/strategies/{{strategyId}}",
					"protocol": "https",
					"host": [
						"{{ip}}"
					],
					"port": "{{port}}",
					"path": [
						"rest",
						"apigateway",
						"strategies",
						"{{strategyId}}"
					]
				}
			},
			"response": []
		},
		{
			"name": "Get all APIs",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {\r",
							"    pm.response.to.have.status(200);\r",
							"});\r",
							"\r",
							"postman.setNextRequest(null);\r",
							"\r",
							"let apis = JSON.parse(responseBody).apiResponse;\r",
							"if (apis === undefined || apis === null || apis.length === 0 || apis[0].responseStatus === \"NOT_FOUND\") {\r",
							"    postman.setNextRequest(null);\r",
							"} else {\r",
							"    let apiIds = apis.map(api => api.api.id);\r",
							"    let apiId = apiIds.pop();\r",
							"    let apiIdsString = JSON.stringify(apiIds);\r",
							"    pm.globals.set(\"apiIds\", apiIdsString);\r",
							"    pm.globals.set(\"apiId\", apiId);\r",
							"    postman.setNextRequest(\"Get and Validate one API\");\r",
							"}"
						],
						"type": "text/javascript",
						"id": "c60bc514-4cc5-4f35-a6b6-935e29d3c0fb"
					}
				}
			],
			"id": "af1c9ecc-fa9a-4654-940e-3181148bba11",
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Accept",
						"value": "application/json",
						"type": "text"
					},
					{
						"key": "Host",
						"value": "{{hostname}}"
					}
				],
				"url": {
					"raw": "https://{{ip}}:{{port}}/rest/apigateway/apis",
					"protocol": "https",
					"host": [
						"{{ip}}"
					],
					"port": "{{port}}",
					"path": [
						"rest",
						"apigateway",
						"apis"
					]
				}
			},
			"response": []
		},
		{
			"name": "Get and Validate one API",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {\r",
							"    pm.response.to.have.status(200);\r",
							"});\r",
							"\r",
							"postman.setNextRequest(null);\r",
							"\r",
							"let api = JSON.parse(responseBody).apiResponse.api;\r",
							"if (api === undefined || api === null || api.apiDefinition === undefined || api.apiDefinition === null) {\r",
							"    postman.setNextRequest(null);\r",
							"} else {\r",
							"    if (api.apiGroups === undefined || api.apiGroups === null || api.apiGroups.length === 0) { // API invalid\r",
							"        console.log(\"API must be assigned to one or more API groups\");\r",
							"        console.log(\"ID: \" + api.id);\r",
							"        console.log(\"Name: \" + api.apiName);\r",
							"        console.log(\"Version: \" + api.apiVersion);\r",
							"        console.log(\"Description: \" + api.apiDescription);\r",
							"\r",
							"        pm.test(\"API assigned to one or more API groups\", function () {\r",
							"            pm.expect.fail(\"API not assigned to an API group\");\r",
							"        });\r",
							"\r",
							"        postman.setNextRequest(null);\r",
							"    } else if (api.apiGroups === undefined || api.apiGroups === null || !api.apiGroups.includes(\"Internal\")) { // API invalid\r",
							"        console.log(\"API must be assigned to API group Internal\");\r",
							"        console.log(\"ID: \" + api.id);\r",
							"        console.log(\"Name: \" + api.apiName);\r",
							"        console.log(\"Version: \" + api.apiVersion);\r",
							"        console.log(\"Description: \" + api.apiDescription);\r",
							"\r",
							"        pm.test(\"API assigned to API group Internal\", function () {\r",
							"            pm.expect.fail(\"API not assigned to API group Internal\");\r",
							"        });\r",
							"\r",
							"        postman.setNextRequest(null);\r",
							"    } else { // API valid\r",
							"        api.apiDefinition.tags = api.apiDefinition.tags || [];\r",
							"        api.apiDefinition.tags.push({\"name\":\"BuildId:{{buildId}}\"});\r",
							"        api.apiDefinition.tags.push({\"name\":\"BuildNumber:{{buildNumber}}\"});\r",
							"        api.apiDefinition.tags.push({\"name\":\"PipelineName:{{definitionName}}\"});\r",
							"//      api.apiDefinition.tags.push({\"name\":\"PipelineVersion:{{definitionVersion}}\"});\r",
							"        api.apiDefinition.apiTags = api.apiDefinition.apiTags || [];\r",
							"        api.apiDefinition.apiTags.push(\"BuildId:{{buildId}}\");\r",
							"        api.apiDefinition.apiTags.push(\"BuildNumber:{{buildNumber}}\");\r",
							"        api.apiDefinition.apiTags.push(\"PipelineName:{{definitionName}}\");\r",
							"//      api.apiDefinition.apiTags.push(\"PipelineVersion:{{definitionVersion}}\");\r",
							"        let apiString = JSON.stringify(api);\r",
							"        pm.globals.set(\"api\", apiString);\r",
							"\r",
							"        console.log(\"Update API\");\r",
							"        console.log(\"ID: \" + api.id);\r",
							"        console.log(\"Name: \" + api.apiName);\r",
							"        console.log(\"Version: \" + api.apiVersion);\r",
							"\r",
							"        postman.setNextRequest(\"Update one API\");\r",
							"    }\r",
							"}"
						],
						"type": "text/javascript",
						"id": "db643cff-c5e3-4db5-8f7b-57c669360798"
					}
				}
			],
			"id": "ab10cf2c-729e-4ce6-bae2-fe8a949810a8",
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Accept",
						"value": "application/json",
						"type": "text"
					},
					{
						"key": "Host",
						"value": "{{hostname}}"
					}
				],
				"url": {
					"raw": "https://{{ip}}:{{port}}/rest/apigateway/apis/{{apiId}}",
					"protocol": "https",
					"host": [
						"{{ip}}"
					],
					"port": "{{port}}",
					"path": [
						"rest",
						"apigateway",
						"apis",
						"{{apiId}}"
					]
				}
			},
			"response": []
		},
		{
			"name": "Update one API",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {\r",
							"    pm.response.to.have.status(200);\r",
							"});\r",
							"\r",
							"pm.test(\"Response contains apiResponse\", function () {\r",
							"    var jsonData = pm.response.json();\r",
							"    pm.expect(jsonData.apiResponse).to.exist;\r",
							"});\r",
							"\r",
							"pm.test(\"Response contains api\", function () {\r",
							"    var jsonData = pm.response.json();\r",
							"    pm.expect(jsonData.apiResponse.api).to.exist;\r",
							"});\r",
							"\r",
							"pm.test(\"Response contains apiDefinition\", function () {\r",
							"    var jsonData = pm.response.json();\r",
							"    pm.expect(jsonData.apiResponse.api.apiDefinition).to.exist;\r",
							"});\r",
							"\r",
							"pm.test(\"Response contains tags\", function () {\r",
							"    var jsonData = pm.response.json();\r",
							"    pm.expect(jsonData.apiResponse.api.apiDefinition.tags).to.exist;\r",
							"});\r",
							"\r",
							"pm.test(\"Response contains apiTags\", function () {\r",
							"    var jsonData = pm.response.json();\r",
							"    pm.expect(jsonData.apiResponse.api.apiDefinition.apiTags).to.exist;\r",
							"});\r",
							"\r",
							"console.log(\"tags set to: \" + JSON.stringify(pm.response.json().apiResponse.api.apiDefinition.tags));\r",
							"console.log(\"apiTags set to: \" + JSON.stringify(pm.response.json().apiResponse.api.apiDefinition.apiTags));\r",
							"\r",
							"postman.setNextRequest(null);\r",
							"\r",
							"let apiIds = JSON.parse(pm.globals.get(\"apiIds\"));\r",
							"if (apiIds === undefined || apiIds === null || apiIds.length === 0) {\r",
							"    postman.setNextRequest(null);\r",
							"} else {\r",
							"    let apiId = apiIds.pop();\r",
							"    let apiIdsString = JSON.stringify(apiIds);\r",
							"    pm.globals.set(\"apiIds\", apiIdsString);\r",
							"    pm.globals.set(\"apiId\", apiId);\r",
							"    postman.setNextRequest(\"Get and Validate one API\");\r",
							"}"
						],
						"type": "text/javascript",
						"id": "9e3a4c2b-e81c-4a02-b1ac-fd3089c59238"
					}
				}
			],
			"id": "05316f81-57f1-460b-9f99-d15244e06b1c",
			"request": {
				"method": "PUT",
				"header": [
					{
						"key": "Accept",
						"value": "application/json",
						"type": "text"
					},
					{
						"key": "Host",
						"value": "{{hostname}}"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{{api}}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "https://{{ip}}:{{port}}/rest/apigateway/apis/{{apiId}}",
					"protocol": "https",
					"host": [
						"{{ip}}"
					],
					"port": "{{port}}",
					"path": [
						"rest",
						"apigateway",
						"apis",
						"{{apiId}}"
					]
				}
			},
			"response": []
		}
	],
	"auth": {
		"type": "basic",
		"basic": [
			{
				"key": "password",
				"value": "{{preparer_password}}",
				"type": "string"
			},
			{
				"key": "username",
				"value": "{{preparer_user}}",
				"type": "string"
			}
		]
	},
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				],
				"id": "ec825345-ca9f-4e0b-bb05-852eb4b1f735"
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				],
				"id": "5952d091-0c25-4b19-833a-c9bb87e120ef"
			}
		}
	]
}