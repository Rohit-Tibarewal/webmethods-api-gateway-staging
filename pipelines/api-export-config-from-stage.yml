# Pipeline for apig staging

trigger: none

parameters:
- name: tenant
  displayName: Export API Gateway configuration in which tenant?
  type: string
  default: playground
  values:
  - playground
  - realworld
- name: sourceType
  displayName: Export API Gateway configuration from which API Gateway?
  type: string
  values:
  - CONFIG
  - BUILD
  - DEV_INT
  - DEV_EXT
  - STAGE_INT
  - STAGE_EXT
  - PROD_INT
  - PROD_EXT
- name: commitMessage
  displayName: Message for the commit in Git?
  type: string

jobs:
- job: Export_config_from_API_Gateway_${{parameters.sourceType}}
  variables:
  - template: /${{parameters.tenant}}/variables/${{parameters.sourceType}}/variables-template.yml
  pool:
    name: '$(agent_pool)'
    vmImage: '$(agent_pool_vmImage)'
  steps:
  - checkout: self
    submodules: "true"
    persistCredentials: "true"
    clean: "true"
  - template: /pipelines/api-export-config-template.yml  # Template reference
    parameters:
      environment: $(environment)
      type: ${{parameters.sourceType}}
      tenant: ${{parameters.tenant}}
  - template: /pipelines/commit-template.yml  # Template reference
    parameters:
      commitMessage: ${{parameters.commitMessage}}